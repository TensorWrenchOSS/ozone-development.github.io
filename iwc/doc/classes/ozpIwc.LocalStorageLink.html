<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>ozpIwc.LocalStorageLink - ozpIwc</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="ozpIwc"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.2.3</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/ozpIwc.ApiError.html">ozpIwc.ApiError</a></li>
            
                <li><a href="../classes/ozpIwc.AsyncAction.html">ozpIwc.AsyncAction</a></li>
            
                <li><a href="../classes/ozpIwc.CancelableEvent.html">ozpIwc.CancelableEvent</a></li>
            
                <li><a href="../classes/ozpIwc.Client.html">ozpIwc.Client</a></li>
            
                <li><a href="../classes/ozpIwc.CommonApiBase.html">ozpIwc.CommonApiBase</a></li>
            
                <li><a href="../classes/ozpIwc.CommonApiCollectionValue.html">ozpIwc.CommonApiCollectionValue</a></li>
            
                <li><a href="../classes/ozpIwc.CommonApiValue.html">ozpIwc.CommonApiValue</a></li>
            
                <li><a href="../classes/ozpIwc.DataApi.html">ozpIwc.DataApi</a></li>
            
                <li><a href="../classes/ozpIwc.DataApiValue.html">ozpIwc.DataApiValue</a></li>
            
                <li><a href="../classes/ozpIwc.Endpoint.html">ozpIwc.Endpoint</a></li>
            
                <li><a href="../classes/ozpIwc.EndpointRegistry.html">ozpIwc.EndpointRegistry</a></li>
            
                <li><a href="../classes/ozpIwc.Event.html">ozpIwc.Event</a></li>
            
                <li><a href="../classes/ozpIwc.FragmentPacket.html">ozpIwc.FragmentPacket</a></li>
            
                <li><a href="../classes/ozpIwc.FragmentStore.html">ozpIwc.FragmentStore</a></li>
            
                <li><a href="../classes/ozpIwc.IntentsApi.html">ozpIwc.IntentsApi</a></li>
            
                <li><a href="../classes/ozpIwc.IntentsApiDefinitionValue.html">ozpIwc.IntentsApiDefinitionValue</a></li>
            
                <li><a href="../classes/ozpIwc.IntentsApiHandlerValue.html">ozpIwc.IntentsApiHandlerValue</a></li>
            
                <li><a href="../classes/ozpIwc.IntentsApiTypeValue.html">ozpIwc.IntentsApiTypeValue</a></li>
            
                <li><a href="../classes/ozpIwc.InternalParticipant.html">ozpIwc.InternalParticipant</a></li>
            
                <li><a href="../classes/ozpIwc.KeyBroadcastLocalStorageLink.html">ozpIwc.KeyBroadcastLocalStorageLink</a></li>
            
                <li><a href="../classes/ozpIwc.LeaderGroupParticipant.html">ozpIwc.LeaderGroupParticipant</a></li>
            
                <li><a href="../classes/ozpIwc.LocalStorageLink.html">ozpIwc.LocalStorageLink</a></li>
            
                <li><a href="../classes/ozpIwc.log.html">ozpIwc.log</a></li>
            
                <li><a href="../classes/ozpIwc.MetricsRegistry.html">ozpIwc.MetricsRegistry</a></li>
            
                <li><a href="../classes/ozpIwc.metricsStats.Sample.html">ozpIwc.metricsStats.Sample</a></li>
            
                <li><a href="../classes/ozpIwc.metricsStats.UniformSample.html">ozpIwc.metricsStats.UniformSample</a></li>
            
                <li><a href="../classes/ozpIwc.metricStats.html">ozpIwc.metricStats</a></li>
            
                <li><a href="../classes/ozpIwc.metricStats.BinaryHeap.html">ozpIwc.metricStats.BinaryHeap</a></li>
            
                <li><a href="../classes/ozpIwc.metricStats.ExponentiallyDecayingSample.html">ozpIwc.metricStats.ExponentiallyDecayingSample</a></li>
            
                <li><a href="../classes/ozpIwc.metricTypes.BaseMetric.html">ozpIwc.metricTypes.BaseMetric</a></li>
            
                <li><a href="../classes/ozpIwc.metricTypes.Counter.html">ozpIwc.metricTypes.Counter</a></li>
            
                <li><a href="../classes/ozpIwc.metricTypes.Gauge.html">ozpIwc.metricTypes.Gauge</a></li>
            
                <li><a href="../classes/ozpIwc.metricTypes.Histogram.html">ozpIwc.metricTypes.Histogram</a></li>
            
                <li><a href="../classes/ozpIwc.metricTypes.Meter.html">ozpIwc.metricTypes.Meter</a></li>
            
                <li><a href="../classes/ozpIwc.MulticastParticipant.html">ozpIwc.MulticastParticipant</a></li>
            
                <li><a href="../classes/ozpIwc.NamesApi.html">ozpIwc.NamesApi</a></li>
            
                <li><a href="../classes/ozpIwc.NamesApiValue.html">ozpIwc.NamesApiValue</a></li>
            
                <li><a href="../classes/ozpIwc.NetworkPacket.html">ozpIwc.NetworkPacket</a></li>
            
                <li><a href="../classes/ozpIwc.Participant.html">ozpIwc.Participant</a></li>
            
                <li><a href="../classes/ozpIwc.Peer.html">ozpIwc.Peer</a></li>
            
                <li><a href="../classes/ozpIwc.policyAuth.PDP.html">ozpIwc.policyAuth.PDP</a></li>
            
                <li><a href="../classes/ozpIwc.policyAuth.SecurityAttribute.html">ozpIwc.policyAuth.SecurityAttribute</a></li>
            
                <li><a href="../classes/ozpIwc.PostMessageParticipant.html">ozpIwc.PostMessageParticipant</a></li>
            
                <li><a href="../classes/ozpIwc.PostMessageParticipantListener.html">ozpIwc.PostMessageParticipantListener</a></li>
            
                <li><a href="../classes/ozpIwc.Router.html">ozpIwc.Router</a></li>
            
                <li><a href="../classes/ozpIwc.RouterWatchdog.html">ozpIwc.RouterWatchdog</a></li>
            
                <li><a href="../classes/ozpIwc.SystemApi.html">ozpIwc.SystemApi</a></li>
            
                <li><a href="../classes/ozpIwc.SystemApiApplicationValue.html">ozpIwc.SystemApiApplicationValue</a></li>
            
                <li><a href="../classes/ozpIwc.Timer.html">ozpIwc.Timer</a></li>
            
                <li><a href="../classes/ozpIwc.TransportPacket.html">ozpIwc.TransportPacket</a></li>
            
                <li><a href="../classes/ozpIwc.TransportPacketContext.html">ozpIwc.TransportPacketContext</a></li>
            
                <li><a href="../classes/ozpIwc.util.html">ozpIwc.util</a></li>
            
                <li><a href="../classes/ozpIwcPolicies.html">ozpIwcPolicies</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/bus.html">bus</a></li>
            
                <li><a href="../modules/bus.api.html">bus.api</a></li>
            
                <li><a href="../modules/bus.api.Type.html">bus.api.Type</a></li>
            
                <li><a href="../modules/bus.api.Value.html">bus.api.Value</a></li>
            
                <li><a href="../modules/bus.network.html">bus.network</a></li>
            
                <li><a href="../modules/bus.network.packets.html">bus.network.packets</a></li>
            
                <li><a href="../modules/bus.security.html">bus.security</a></li>
            
                <li><a href="../modules/bus.transport.html">bus.transport</a></li>
            
                <li><a href="../modules/bus.util.html">bus.util</a></li>
            
                <li><a href="../modules/client.html">client</a></li>
            
                <li><a href="../modules/common.html">common</a></li>
            
                <li><a href="../modules/metrics.html">metrics</a></li>
            
                <li><a href="../modules/metrics.statistics.html">metrics.statistics</a></li>
            
                <li><a href="../modules/metrics.types.html">metrics.types</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1>ozpIwc.LocalStorageLink Class</h1>
<div class="box meta">
    

    

    
        <div class="foundat">
            Defined in: <a href="../files/app_js_bus_network_localStorageLink.js.html#l5"><code>app&#x2F;js&#x2F;bus&#x2F;network&#x2F;localStorageLink.js:5</code></a>
        </div>
    

    
        
            Module: <a href="../modules/bus.network.html">bus.network</a><br>
            Parent Module: <a href="../modules/bus.html">bus</a>
        
    

    
</div>



<div class="box intro">
    <p><p>This link connects peers using the HTML5 localstorage API.  It handles cleaning up
the buffer, depduplication of sends, and other trivia.</p>
<p><p>Individual local storage operations are atomic, but there are no consistency
gaurantees between multiple calls.  This means a read, modify, write operation may
create race conditions.  The LocalStorageLink addresses the concurrency problem without
locks by only allowing creation, read, and delete operations.</p>
<p><p>Each packet is written to it&#39;s own key/value pair in local storage.  The key is the
of the form &quot;${prefix}|${selfId}|${timestamp}&quot;.  Each LocalStorageLink owns the lifecycle
of packets it creates.</p>
<p>For senders:</p>
<ol>
  <li> Write a new packet.
  <li> Wait config.myKeysTimeout milliseconds.
  <li> Delete own packets where the timestamp is expired.
</ol>

<p>For receivers:</p>
<ol>
  <li> Receive a &quot;storage&quot; event containing the new key.
  <li> Reads the packets from local storage.
</ol>

<p><p>The potential race condition is if the packet is deleted before the receiver
can read it.  In this case, the packet is simply considered lost, but no inconsistent
data will be read.</p>
<p><p>Links are responsible for their own packets, but each will clean up other link&#39;s packets
on a much larger expiration window (config.otherKeysTimeout).  Race conditions between
multiple links interleaving the lockless &quot;list keys&quot; and &quot;delete item&quot; sequence generates
a consistent postcondition-- the key will not exist.</p>

</div>



<div id="classdocs" class="tabview">
    <ul class="api-class-tabs">
        <li class="api-class-tab index"><a href="#index">Index</a></li>

        
            <li class="api-class-tab methods"><a href="#methods">Methods</a></li>
        
        
            <li class="api-class-tab properties"><a href="#properties">Properties</a></li>
        
        
        
    </ul>

    <div>
        <div id="index" class="api-class-tabpanel index">
            <h2 class="off-left">Item Index</h2>

            
                <div class="index-section methods">
                    <h3>Methods</h3>

                    <ul class="index-list methods">
                        
                            <li class="index-item method">
                                <a href="#method_cleanKeys">cleanKeys</a>

                                
                                
                            </li>
                        
                            <li class="index-item method">
                                <a href="#method_makeKey">makeKey</a>

                                
                                
                            </li>
                        
                            <li class="index-item method">
                                <a href="#method_send">send</a>

                                
                                
                            </li>
                        
                            <li class="index-item method">
                                <a href="#method_splitKey">splitKey</a>

                                
                                
                            </li>
                        
                    </ul>
                </div>
            

            
                <div class="index-section properties">
                    <h3>Properties</h3>

                    <ul class="index-list properties">
                        
                            <li class="index-item property">
                                <a href="#property_myKeysTimeout">myKeysTimeout</a>

                                
                                
                            </li>
                        
                            <li class="index-item property">
                                <a href="#property_otherKeysTimeout">otherKeysTimeout</a>

                                
                                
                            </li>
                        
                            <li class="index-item property">
                                <a href="#property_peer">peer</a>

                                
                                
                            </li>
                        
                            <li class="index-item property">
                                <a href="#property_prefix">prefix</a>

                                
                                
                            </li>
                        
                            <li class="index-item property">
                                <a href="#property_selfId">selfId</a>

                                
                                
                            </li>
                        
                    </ul>
                </div>
            

            

            
        </div>

        
            <div id="methods" class="api-class-tabpanel">
                <h2 class="off-left">Methods</h2>

                
                    <div id="method_cleanKeys" class="method item">
    <h3 class="name"><code>cleanKeys</code></h3>

    
        <span class="paren">()</span>
    

    

    

    

    

    

    

    

    <div class="meta">
        
            
                
                <p>
                
                Defined in
                
            
        
        
        <a href="../files/app_js_bus_network_localStorageLink.js.html#l193"><code>app&#x2F;js&#x2F;bus&#x2F;network&#x2F;localStorageLink.js:193</code></a>
        
        </p>


        

        
    </div>

    <div class="description">
        <p>Goes through localStorage and looks for expired packets.  Packets owned
by this link are removed if they are older than myKeysTimeout.  Other
keys are cleaned if they are older than otherKeysTimeout.</p>

    </div>

    

    

    
</div>

                
                    <div id="method_makeKey" class="method item">
    <h3 class="name"><code>makeKey</code></h3>

    
        <span class="paren">()</span>
    

    
        <span class="returns-inline">
            <span class="type">String</span>
        </span>
    

    

    

    

    

    

    

    <div class="meta">
        
            
                
                <p>
                
                Defined in
                
            
        
        
        <a href="../files/app_js_bus_network_localStorageLink.js.html#l164"><code>app&#x2F;js&#x2F;bus&#x2F;network&#x2F;localStorageLink.js:164</code></a>
        
        </p>


        

        
    </div>

    <div class="description">
        <p>Creates a key for the message in localStorage</p>

    </div>

    

    
        <div class="returns">
            <h4>Returns:</h4>

            <div class="returns-description">
                
                    
                        <span class="type">String</span>:
                    
                    <p>a new key</p>

                
            </div>
        </div>
    

    
</div>

                
                    <div id="method_send" class="method item">
    <h3 class="name"><code>send</code></h3>

    
        <div class="args">
            <span class="paren">(</span><ul class="args-list inline commas">
            
                <li class="arg">
                    
                        <code>packet</code>
                    
                </li>
            
            </ul><span class="paren">)</span>
        </div>
    

    

    

    

    

    

    

    

    <div class="meta">
        
            
                
                <p>
                
                Defined in
                
            
        
        
        <a href="../files/app_js_bus_network_localStorageLink.js.html#l219"><code>app&#x2F;js&#x2F;bus&#x2F;network&#x2F;localStorageLink.js:219</code></a>
        
        </p>


        

        
    </div>

    <div class="description">
        <p>Publishes a packet to other peers.</p>

    </div>

    
        <div class="params">
            <h4>Parameters:</h4>

            <ul class="params-list">
            
                <li class="param">
                    
                        <code class="param-name">packet</code>
                        <span class="type"><a href="../classes/ozpIwc.NetworkPacket.html" class="crosslink">ozpIwc.NetworkPacket</a></span>
                    

                    

                    <div class="param-description">
                         
                    </div>

                    
                </li>
            
            </ul>
        </div>
    

    

    
</div>

                
                    <div id="method_splitKey" class="method item">
    <h3 class="name"><code>splitKey</code></h3>

    
        <div class="args">
            <span class="paren">(</span><ul class="args-list inline commas">
            
                <li class="arg">
                    
                        <code>k</code>
                    
                </li>
            
            </ul><span class="paren">)</span>
        </div>
    

    
        <span class="returns-inline">
            <span class="type">Object</span>
        </span>
    

    

    

    

    

    

    

    <div class="meta">
        
            
                
                <p>
                
                Defined in
                
            
        
        
        <a href="../files/app_js_bus_network_localStorageLink.js.html#l176"><code>app&#x2F;js&#x2F;bus&#x2F;network&#x2F;localStorageLink.js:176</code></a>
        
        </p>


        

        
    </div>

    <div class="description">
        <p>If it&#39;s a key for a buffered message, split it into the id of the 
link that put it here and the time it was created at.</p>

    </div>

    
        <div class="params">
            <h4>Parameters:</h4>

            <ul class="params-list">
            
                <li class="param">
                    
                        <code class="param-name">k</code>
                        <span class="type">String</span>
                    

                    

                    <div class="param-description">
                        <p>The key to split</p>

                    </div>

                    
                </li>
            
            </ul>
        </div>
    

    
        <div class="returns">
            <h4>Returns:</h4>

            <div class="returns-description">
                
                    
                        <span class="type">Object</span>:
                    
                    <p>The id and createdAt for the key if it&#39;s valid, otherwise null.</p>

                
            </div>
        </div>
    

    
</div>

                
            </div>
        

        
            <div id="properties" class="api-class-tabpanel">
                <h2 class="off-left">Properties</h2>

                
                    <div id="property_myKeysTimeout" class="property item">
    <h3 class="name"><code>myKeysTimeout</code></h3>
    <span class="type">Number</span>

    

    

    

    

    <div class="meta">
        
            
                
                <p>
                
                Defined in
                
            
        
        
        <a href="../files/app_js_bus_network_localStorageLink.js.html#l78"><code>app&#x2F;js&#x2F;bus&#x2F;network&#x2F;localStorageLink.js:78</code></a>
        
        </p>

        

        
    </div>

    <div class="description">
        <p>Milliseconds to wait before deleting this link&#39;s keys</p>

    </div>

    
        <p><strong>Default:</strong> 5000</p>
    

    

    
</div>

                
                    <div id="property_otherKeysTimeout" class="property item">
    <h3 class="name"><code>otherKeysTimeout</code></h3>
    <span class="type">Number</span>

    

    

    

    

    <div class="meta">
        
            
                
                <p>
                
                Defined in
                
            
        
        
        <a href="../files/app_js_bus_network_localStorageLink.js.html#l86"><code>app&#x2F;js&#x2F;bus&#x2F;network&#x2F;localStorageLink.js:86</code></a>
        
        </p>

        

        
    </div>

    <div class="description">
        <p>Milliseconds to wait before deleting other link&#39;s keys</p>

    </div>

    
        <p><strong>Default:</strong> 120000</p>
    

    

    
</div>

                
                    <div id="property_peer" class="property item">
    <h3 class="name"><code>peer</code></h3>
    <span class="type"><a href="../classes/ozpIwc.Peer.html" class="crosslink">ozpIwc.Peer</a></span>

    

    

    

    

    <div class="meta">
        
            
                
                <p>
                
                Defined in
                
            
        
        
        <a href="../files/app_js_bus_network_localStorageLink.js.html#l61"><code>app&#x2F;js&#x2F;bus&#x2F;network&#x2F;localStorageLink.js:61</code></a>
        
        </p>

        

        
    </div>

    <div class="description">
        <p>The peer this link will connect to.</p>

    </div>

    
        <p><strong>Default:</strong> ozpIwc.defaultPeer</p>
    

    

    
</div>

                
                    <div id="property_prefix" class="property item">
    <h3 class="name"><code>prefix</code></h3>
    <span class="type">String</span>

    

    

    

    

    <div class="meta">
        
            
                
                <p>
                
                Defined in
                
            
        
        
        <a href="../files/app_js_bus_network_localStorageLink.js.html#l53"><code>app&#x2F;js&#x2F;bus&#x2F;network&#x2F;localStorageLink.js:53</code></a>
        
        </p>

        

        
    </div>

    <div class="description">
        <p>Namespace for communicating, must be the same for all peers on the same network.</p>

    </div>

    
        <p><strong>Default:</strong> &quot;ozpIwc&quot;</p>
    

    

    
</div>

                
                    <div id="property_selfId" class="property item">
    <h3 class="name"><code>selfId</code></h3>
    <span class="type">String</span>

    

    

    

    

    <div class="meta">
        
            
                
                <p>
                
                Defined in
                
            
        
        
        <a href="../files/app_js_bus_network_localStorageLink.js.html#l69"><code>app&#x2F;js&#x2F;bus&#x2F;network&#x2F;localStorageLink.js:69</code></a>
        
        </p>

        

        
    </div>

    <div class="description">
        <p>Unique name within the peer network.  Defaults to the peer id.</p>

    </div>

    
        <p><strong>Default:</strong> ozpIwc.defaultPeer.selfId</p>
    

    

    
</div>

                
            </div>
        

        

        
    </div>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
