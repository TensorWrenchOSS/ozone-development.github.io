<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>app/js/debugger/debugger.js - ozpIwc</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="ozpIwc"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.2.2</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/ozpIwc.ApiError.html">ozpIwc.ApiError</a></li>
            
                <li><a href="../classes/ozpIwc.AsyncAction.html">ozpIwc.AsyncAction</a></li>
            
                <li><a href="../classes/ozpIwc.CancelableEvent.html">ozpIwc.CancelableEvent</a></li>
            
                <li><a href="../classes/ozpIwc.Client.html">ozpIwc.Client</a></li>
            
                <li><a href="../classes/ozpIwc.CommonApiBase.html">ozpIwc.CommonApiBase</a></li>
            
                <li><a href="../classes/ozpIwc.CommonApiCollectionValue.html">ozpIwc.CommonApiCollectionValue</a></li>
            
                <li><a href="../classes/ozpIwc.CommonApiValue.html">ozpIwc.CommonApiValue</a></li>
            
                <li><a href="../classes/ozpIwc.DataApi.html">ozpIwc.DataApi</a></li>
            
                <li><a href="../classes/ozpIwc.DataApiValue.html">ozpIwc.DataApiValue</a></li>
            
                <li><a href="../classes/ozpIwc.Endpoint.html">ozpIwc.Endpoint</a></li>
            
                <li><a href="../classes/ozpIwc.EndpointRegistry.html">ozpIwc.EndpointRegistry</a></li>
            
                <li><a href="../classes/ozpIwc.Event.html">ozpIwc.Event</a></li>
            
                <li><a href="../classes/ozpIwc.FragmentPacket.html">ozpIwc.FragmentPacket</a></li>
            
                <li><a href="../classes/ozpIwc.FragmentStore.html">ozpIwc.FragmentStore</a></li>
            
                <li><a href="../classes/ozpIwc.IntentsApi.html">ozpIwc.IntentsApi</a></li>
            
                <li><a href="../classes/ozpIwc.IntentsApiDefinitionValue.html">ozpIwc.IntentsApiDefinitionValue</a></li>
            
                <li><a href="../classes/ozpIwc.IntentsApiHandlerValue.html">ozpIwc.IntentsApiHandlerValue</a></li>
            
                <li><a href="../classes/ozpIwc.IntentsApiTypeValue.html">ozpIwc.IntentsApiTypeValue</a></li>
            
                <li><a href="../classes/ozpIwc.InternalParticipant.html">ozpIwc.InternalParticipant</a></li>
            
                <li><a href="../classes/ozpIwc.KeyBroadcastLocalStorageLink.html">ozpIwc.KeyBroadcastLocalStorageLink</a></li>
            
                <li><a href="../classes/ozpIwc.LeaderGroupParticipant.html">ozpIwc.LeaderGroupParticipant</a></li>
            
                <li><a href="../classes/ozpIwc.LocalStorageLink.html">ozpIwc.LocalStorageLink</a></li>
            
                <li><a href="../classes/ozpIwc.log.html">ozpIwc.log</a></li>
            
                <li><a href="../classes/ozpIwc.MetricsRegistry.html">ozpIwc.MetricsRegistry</a></li>
            
                <li><a href="../classes/ozpIwc.metricsStats.Sample.html">ozpIwc.metricsStats.Sample</a></li>
            
                <li><a href="../classes/ozpIwc.metricsStats.UniformSample.html">ozpIwc.metricsStats.UniformSample</a></li>
            
                <li><a href="../classes/ozpIwc.metricStats.html">ozpIwc.metricStats</a></li>
            
                <li><a href="../classes/ozpIwc.metricStats.BinaryHeap.html">ozpIwc.metricStats.BinaryHeap</a></li>
            
                <li><a href="../classes/ozpIwc.metricStats.ExponentiallyDecayingSample.html">ozpIwc.metricStats.ExponentiallyDecayingSample</a></li>
            
                <li><a href="../classes/ozpIwc.metricTypes.BaseMetric.html">ozpIwc.metricTypes.BaseMetric</a></li>
            
                <li><a href="../classes/ozpIwc.metricTypes.Counter.html">ozpIwc.metricTypes.Counter</a></li>
            
                <li><a href="../classes/ozpIwc.metricTypes.Gauge.html">ozpIwc.metricTypes.Gauge</a></li>
            
                <li><a href="../classes/ozpIwc.metricTypes.Histogram.html">ozpIwc.metricTypes.Histogram</a></li>
            
                <li><a href="../classes/ozpIwc.metricTypes.Meter.html">ozpIwc.metricTypes.Meter</a></li>
            
                <li><a href="../classes/ozpIwc.MulticastParticipant.html">ozpIwc.MulticastParticipant</a></li>
            
                <li><a href="../classes/ozpIwc.NamesApi.html">ozpIwc.NamesApi</a></li>
            
                <li><a href="../classes/ozpIwc.NamesApiValue.html">ozpIwc.NamesApiValue</a></li>
            
                <li><a href="../classes/ozpIwc.NetworkPacket.html">ozpIwc.NetworkPacket</a></li>
            
                <li><a href="../classes/ozpIwc.Participant.html">ozpIwc.Participant</a></li>
            
                <li><a href="../classes/ozpIwc.Peer.html">ozpIwc.Peer</a></li>
            
                <li><a href="../classes/ozpIwc.policyAuth.PDP.html">ozpIwc.policyAuth.PDP</a></li>
            
                <li><a href="../classes/ozpIwc.policyAuth.SecurityAttribute.html">ozpIwc.policyAuth.SecurityAttribute</a></li>
            
                <li><a href="../classes/ozpIwc.PostMessageParticipant.html">ozpIwc.PostMessageParticipant</a></li>
            
                <li><a href="../classes/ozpIwc.PostMessageParticipantListener.html">ozpIwc.PostMessageParticipantListener</a></li>
            
                <li><a href="../classes/ozpIwc.Router.html">ozpIwc.Router</a></li>
            
                <li><a href="../classes/ozpIwc.RouterWatchdog.html">ozpIwc.RouterWatchdog</a></li>
            
                <li><a href="../classes/ozpIwc.SystemApi.html">ozpIwc.SystemApi</a></li>
            
                <li><a href="../classes/ozpIwc.SystemApiApplicationValue.html">ozpIwc.SystemApiApplicationValue</a></li>
            
                <li><a href="../classes/ozpIwc.Timer.html">ozpIwc.Timer</a></li>
            
                <li><a href="../classes/ozpIwc.TransportPacket.html">ozpIwc.TransportPacket</a></li>
            
                <li><a href="../classes/ozpIwc.TransportPacketContext.html">ozpIwc.TransportPacketContext</a></li>
            
                <li><a href="../classes/ozpIwc.util.html">ozpIwc.util</a></li>
            
                <li><a href="../classes/ozpIwcPolicies.html">ozpIwcPolicies</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/bus.html">bus</a></li>
            
                <li><a href="../modules/bus.api.html">bus.api</a></li>
            
                <li><a href="../modules/bus.api.Type.html">bus.api.Type</a></li>
            
                <li><a href="../modules/bus.api.Value.html">bus.api.Value</a></li>
            
                <li><a href="../modules/bus.network.html">bus.network</a></li>
            
                <li><a href="../modules/bus.network.packets.html">bus.network.packets</a></li>
            
                <li><a href="../modules/bus.security.html">bus.security</a></li>
            
                <li><a href="../modules/bus.transport.html">bus.transport</a></li>
            
                <li><a href="../modules/bus.util.html">bus.util</a></li>
            
                <li><a href="../modules/client.html">client</a></li>
            
                <li><a href="../modules/common.html">common</a></li>
            
                <li><a href="../modules/metrics.html">metrics</a></li>
            
                <li><a href="../modules/metrics.statistics.html">metrics.statistics</a></li>
            
                <li><a href="../modules/metrics.types.html">metrics.types</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: app/js/debugger/debugger.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
var debuggerModule=angular.module(&quot;ozpIwc.debugger&quot;,[
    &#x27;ui.bootstrap&#x27;,
    &#x27;ui.router&#x27;
]).config(function($stateProvider, $urlRouterProvider) {
      // For any unmatched url, redirect to General
      $urlRouterProvider.otherwise(&quot;/general&quot;);

      $stateProvider
        .state(&#x27;general&#x27;, {
            url: &quot;/general&quot;,
            templateUrl: &quot;templates/generalState.tpl.html&quot;
        })
        .state(&#x27;metrics&#x27;, {
            url: &quot;/metrics&quot;,
            templateUrl: &quot;templates/metricsState.tpl.html&quot;
        })
        .state(&#x27;traffic-snooper&#x27;, {
            url: &quot;/traffic-snooper&quot;,
            templateUrl: &quot;templates/trafficSnooperState.tpl.html&quot;
        })
        .state(&#x27;elections&#x27;, {
            url: &quot;/elections&quot;,
            templateUrl: &quot;templates/electionsState.tpl.html&quot;
        })
        .state(&#x27;system-api&#x27;, {
            url: &quot;/system-api&quot;,
            templateUrl: &quot;templates/systemApiState.tpl.html&quot;
        })
        .state(&#x27;data-api&#x27;, {
            url: &quot;/data-api&quot;,
            templateUrl: &quot;templates/dataApiState.tpl.html&quot;
        })
        .state(&#x27;intents-api&#x27;, {
            url: &quot;/intents-api&quot;,
            templateUrl: &quot;templates/intentsApiState.tpl.html&quot;
        })
        .state(&#x27;names-api&#x27;, {
            url: &quot;/names-api&quot;,
            templateUrl: &quot;templates/namesApiState.tpl.html&quot;
        })
        .state(&#x27;hal-browser&#x27;, {
            url: &quot;/hal-browser/:url&quot;,
            templateUrl: &quot;templates/halBrowserState.tpl.html&quot;
        });
});


debuggerModule.factory(&quot;iwcClient&quot;,function() {
    var client=new ozpIwc.InternalParticipant({name: &quot;debuggerClient&quot;});
    ozpIwc.defaultRouter.registerParticipant(client);

    client.connect=function() {
        if(!this.connectPromise) {
            var self=this;
            this.apiMap = {};

            /**
             * Promise to chain off of for client connection asynchronous actions.
             * @property connectPromise
             * @type Promise
             */
            this.connectPromise=new Promise(function(resolve, reject) {

                    self.send({
                        dst: &quot;names.api&quot;,
                        action: &quot;get&quot;,
                        resource: &quot;/api&quot;
                    },function(reply,done){
                        if(reply.response === &#x27;ok&#x27;){
                            resolve(reply.entity);
                        } else{
                            reject(reply.response);
                        }
                        done();
                    });

                }).then(function(apis) {
                    var promiseArray = [];
                    apis.forEach(function (api) {
                        promiseArray.push(new Promise(function (resolve, reject) {
                            self.send({
                                dst: &quot;names.api&quot;,
                                action: &quot;get&quot;,
                                resource: api
                            }, function (res,done) {
                                if (res.response === &#x27;ok&#x27;) {
                                    var name = api.replace(&#x27;/api/&#x27;, &#x27;&#x27;);
                                    self.apiMap[name] = {
                                        &#x27;address&#x27;: name,
                                        &#x27;actions&#x27;: res.entity.actions
                                    };

                                    resolve();
                                } else {
                                    reject(res.response);
                                }
                                done();
                            });
                        }));
                    });
                    return Promise.all(promiseArray);
                }).then(function(){
                    for(var api in self.apiMap){
                        var apiObj = self.apiMap[api];
                        var apiFuncName = apiObj.address.replace(&#x27;.api&#x27;,&#x27;&#x27;);

                        //prevent overriding client constructed fields
                        if(!self.hasOwnProperty(apiFuncName)){
                            // wrap this in a function to break the closure
                            // on apiObj.address that would otherwise register
                            // everything for the last api in the list
                            /*jshint loopfunc:true*/
                            (function(addr){
                                self[apiFuncName] = function(){
                                    return self.api(addr);
                                };
                                self.apiMap[addr] = self.apiMap[addr] || {};
                                self.apiMap[addr].functionName = apiFuncName;
                            })(apiObj.address);
                        }
                    }
                }).then(function() {
                    /**
                     * Fired when the client is connected to the IWC bus.
                     * @event #connected
                     */
                    self.events.trigger(&quot;connected&quot;);
                })[&#x27;catch&#x27;](function(error) {
                ozpIwc.log.log(&quot;Failed to connect to bus &quot;,error);
            });
        }
        return this.connectPromise;
    };


    client.intentInvocationHandling = function(resource,intentResource,callback) {
        var self = this;
        return new Promise(function(resolve,reject) {
            self.send({
                dst: &quot;intents.api&quot;,
                action: &quot;get&quot;,
                resource: intentResource
            }, function (response, done) {
                response.entity.handler = {
                    address: self.address,
                    resource: resource
                };
                response.entity.state = &quot;running&quot;;


                self.send({
                    dst: &quot;intents.api&quot;,
                    contentType: response.contentType,
                    action: &quot;set&quot;,
                    resource: intentResource,
                    entity: response.entity
                }, function (reply, done) {
                    //Now run the intent
                    response.entity.reply.entity = callback(response.entity) || {};
                    // then respond to the inflight resource
                    response.entity.state = &quot;complete&quot;;
                    response.entity.reply.contentType = response.entity.intent.type;
                    self.send({
                        dst: &quot;intents.api&quot;,
                        contentType: response.contentType,
                        action: &quot;set&quot;,
                        resource: intentResource,
                        entity: response.entity
                    });
                    done();
                    resolve(response);
                });
                done();
            });
        });
    };

    client.augment = function (dst,action) {
        var self = this;
        return function (resource, fragment, otherCallback) {
            // If a fragment isn&#x27;t supplied argument #2 should be a callback (if supplied)
            if(typeof fragment === &quot;function&quot;){
                otherCallback = fragment;
                fragment = {};
            }
            return new Promise(function (resolve, reject) {
                var packet = {
                    &#x27;dst&#x27;: dst,
                    &#x27;action&#x27;: action,
                    &#x27;resource&#x27;: resource,
                    &#x27;entity&#x27;: {}
                };
                for (var k in fragment) {
                    packet[k] = fragment[k];
                }
                var packetResponse = false;
                var callbackResponse = !!!otherCallback;
                self.send(packet, function (reply,done) {

                    function initialDone() {
                        if(callbackResponse){
                            done();
                        } else {
                            packetResponse = true;
                        }
                    }

                    function callbackDone() {
                        if(packetResponse){
                            done();
                        } else {
                            callbackResponse = true;
                        }
                    }
                    if (reply.response === &#x27;ok&#x27;) {
                        resolve(reply);
                        initialDone();
                    } else if (/(bad|no).*/.test(reply.response)) {
                        reject(reply);
                        initialDone();
                    }
                    else if (otherCallback) {
                        if(reply.entity &amp;&amp; reply.entity.inFlightIntent) {
                            self.intentInvocationHandling(resource,reply.entity.inFlightIntent,otherCallback,callbackDone);
                        } else {
                            otherCallback(reply, callbackDone);
                        }
                    }
                });
                if(dst === &quot;intents.api&quot; &amp;&amp; action === &quot;register&quot;){
                    for(var i in self.launchedIntents){
                        var loadedResource = &#x27;/&#x27; + self.launchedIntents[i].entity.intent.type + &#x27;/&#x27; + self.launchedIntents[i].entity.intent.action;
                        if(resource === loadedResource){
                            self.intentInvocationHandling(resource,self.launchedIntents[i].resource,otherCallback);
                            delete self.launchedIntents[i];
                        }
                    }
                }
            });
        };
    };

    client.api=function(apiName) {
        this.wrapperMap = this.wrapperMap || {};
        var wrapper = this.wrapperMap[apiName];
        if (!wrapper) {
            if(this.apiMap.hasOwnProperty(apiName)) {
                var api = this.apiMap[apiName];
                wrapper = {};
                for (var i = 0; i &lt; api.actions.length; ++i) {
                    var action = api.actions[i];
                    wrapper[action] = this.augment(api.address, action);
                }

                this.wrapperMap[apiName] = wrapper;
            }
        }
        wrapper.apiName=apiName;
        return wrapper;
    };
    client.connect();
    return client;
});
        
        
debuggerModule.controller(&quot;debuggerController&quot;,[&quot;$scope&quot;,&quot;iwcClient&quot;,function(scope,client) {
    scope.ozpIwc = ozpIwc;
    scope.apiRootUrl = ozpIwc.apiRootUrl;
    scope.tab = &#x27;general&#x27;;
}]);
debuggerModule.service(&quot;apiSettingService&quot;,function(){
    this.apis={
        &#x27;data.api&#x27; : {
            &#x27;address&#x27;: &quot;data.api&quot;,
            &#x27;hasChildren&#x27;:true
        },
        &#x27;intents.api&#x27;: {
            &#x27;address&#x27;: &quot;intents.api&quot;,
            &#x27;actions&#x27;: [{
                action: &quot;invoke&quot;,
                contentTypes: [&#x27;application/vnd.ozp-iwc-intent-definition-v1+json&#x27;,
                    &#x27;application/vnd.ozp-iwc-intent-handler-v1+json&#x27;]
            },{
                action: &quot;broadcast&quot;,
                contentTypes: [&#x27;application/vnd.ozp-iwc-intent-definition-v1+json&#x27;,
                    &#x27;application/vnd.ozp-iwc-intent-handler-v1+json&#x27;]
            }]
        },
        &#x27;system.api&#x27;: {
            &#x27;address&#x27;: &quot;system.api&quot;,
            &#x27;actions&#x27;: [{
                action: &quot;launch&quot;,
                contentTypes: [&#x27;application/vnd.ozp-application-v1+json&#x27;]
            }]
        },
        &#x27;names.api&#x27;: {
            &#x27;address&#x27;: &quot;names.api&quot;
        }
    };
});

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
