<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>app/js/bus/security/pdp.js - ozpIwc</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="ozpIwc"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.2.2</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/ozpIwc.ApiError.html">ozpIwc.ApiError</a></li>
            
                <li><a href="../classes/ozpIwc.AsyncAction.html">ozpIwc.AsyncAction</a></li>
            
                <li><a href="../classes/ozpIwc.CancelableEvent.html">ozpIwc.CancelableEvent</a></li>
            
                <li><a href="../classes/ozpIwc.Client.html">ozpIwc.Client</a></li>
            
                <li><a href="../classes/ozpIwc.CommonApiBase.html">ozpIwc.CommonApiBase</a></li>
            
                <li><a href="../classes/ozpIwc.CommonApiCollectionValue.html">ozpIwc.CommonApiCollectionValue</a></li>
            
                <li><a href="../classes/ozpIwc.CommonApiValue.html">ozpIwc.CommonApiValue</a></li>
            
                <li><a href="../classes/ozpIwc.DataApi.html">ozpIwc.DataApi</a></li>
            
                <li><a href="../classes/ozpIwc.DataApiValue.html">ozpIwc.DataApiValue</a></li>
            
                <li><a href="../classes/ozpIwc.Endpoint.html">ozpIwc.Endpoint</a></li>
            
                <li><a href="../classes/ozpIwc.EndpointRegistry.html">ozpIwc.EndpointRegistry</a></li>
            
                <li><a href="../classes/ozpIwc.Event.html">ozpIwc.Event</a></li>
            
                <li><a href="../classes/ozpIwc.FragmentPacket.html">ozpIwc.FragmentPacket</a></li>
            
                <li><a href="../classes/ozpIwc.FragmentStore.html">ozpIwc.FragmentStore</a></li>
            
                <li><a href="../classes/ozpIwc.IntentsApi.html">ozpIwc.IntentsApi</a></li>
            
                <li><a href="../classes/ozpIwc.IntentsApiDefinitionValue.html">ozpIwc.IntentsApiDefinitionValue</a></li>
            
                <li><a href="../classes/ozpIwc.IntentsApiHandlerValue.html">ozpIwc.IntentsApiHandlerValue</a></li>
            
                <li><a href="../classes/ozpIwc.IntentsApiTypeValue.html">ozpIwc.IntentsApiTypeValue</a></li>
            
                <li><a href="../classes/ozpIwc.InternalParticipant.html">ozpIwc.InternalParticipant</a></li>
            
                <li><a href="../classes/ozpIwc.KeyBroadcastLocalStorageLink.html">ozpIwc.KeyBroadcastLocalStorageLink</a></li>
            
                <li><a href="../classes/ozpIwc.LeaderGroupParticipant.html">ozpIwc.LeaderGroupParticipant</a></li>
            
                <li><a href="../classes/ozpIwc.LocalStorageLink.html">ozpIwc.LocalStorageLink</a></li>
            
                <li><a href="../classes/ozpIwc.log.html">ozpIwc.log</a></li>
            
                <li><a href="../classes/ozpIwc.MetricsRegistry.html">ozpIwc.MetricsRegistry</a></li>
            
                <li><a href="../classes/ozpIwc.metricsStats.Sample.html">ozpIwc.metricsStats.Sample</a></li>
            
                <li><a href="../classes/ozpIwc.metricsStats.UniformSample.html">ozpIwc.metricsStats.UniformSample</a></li>
            
                <li><a href="../classes/ozpIwc.metricStats.html">ozpIwc.metricStats</a></li>
            
                <li><a href="../classes/ozpIwc.metricStats.BinaryHeap.html">ozpIwc.metricStats.BinaryHeap</a></li>
            
                <li><a href="../classes/ozpIwc.metricStats.ExponentiallyDecayingSample.html">ozpIwc.metricStats.ExponentiallyDecayingSample</a></li>
            
                <li><a href="../classes/ozpIwc.metricTypes.BaseMetric.html">ozpIwc.metricTypes.BaseMetric</a></li>
            
                <li><a href="../classes/ozpIwc.metricTypes.Counter.html">ozpIwc.metricTypes.Counter</a></li>
            
                <li><a href="../classes/ozpIwc.metricTypes.Gauge.html">ozpIwc.metricTypes.Gauge</a></li>
            
                <li><a href="../classes/ozpIwc.metricTypes.Histogram.html">ozpIwc.metricTypes.Histogram</a></li>
            
                <li><a href="../classes/ozpIwc.metricTypes.Meter.html">ozpIwc.metricTypes.Meter</a></li>
            
                <li><a href="../classes/ozpIwc.MulticastParticipant.html">ozpIwc.MulticastParticipant</a></li>
            
                <li><a href="../classes/ozpIwc.NamesApi.html">ozpIwc.NamesApi</a></li>
            
                <li><a href="../classes/ozpIwc.NamesApiValue.html">ozpIwc.NamesApiValue</a></li>
            
                <li><a href="../classes/ozpIwc.NetworkPacket.html">ozpIwc.NetworkPacket</a></li>
            
                <li><a href="../classes/ozpIwc.Participant.html">ozpIwc.Participant</a></li>
            
                <li><a href="../classes/ozpIwc.Peer.html">ozpIwc.Peer</a></li>
            
                <li><a href="../classes/ozpIwc.policyAuth.PDP.html">ozpIwc.policyAuth.PDP</a></li>
            
                <li><a href="../classes/ozpIwc.policyAuth.SecurityAttribute.html">ozpIwc.policyAuth.SecurityAttribute</a></li>
            
                <li><a href="../classes/ozpIwc.PostMessageParticipant.html">ozpIwc.PostMessageParticipant</a></li>
            
                <li><a href="../classes/ozpIwc.PostMessageParticipantListener.html">ozpIwc.PostMessageParticipantListener</a></li>
            
                <li><a href="../classes/ozpIwc.Router.html">ozpIwc.Router</a></li>
            
                <li><a href="../classes/ozpIwc.RouterWatchdog.html">ozpIwc.RouterWatchdog</a></li>
            
                <li><a href="../classes/ozpIwc.SystemApi.html">ozpIwc.SystemApi</a></li>
            
                <li><a href="../classes/ozpIwc.SystemApiApplicationValue.html">ozpIwc.SystemApiApplicationValue</a></li>
            
                <li><a href="../classes/ozpIwc.Timer.html">ozpIwc.Timer</a></li>
            
                <li><a href="../classes/ozpIwc.TransportPacket.html">ozpIwc.TransportPacket</a></li>
            
                <li><a href="../classes/ozpIwc.TransportPacketContext.html">ozpIwc.TransportPacketContext</a></li>
            
                <li><a href="../classes/ozpIwc.util.html">ozpIwc.util</a></li>
            
                <li><a href="../classes/ozpIwcPolicies.html">ozpIwcPolicies</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/bus.html">bus</a></li>
            
                <li><a href="../modules/bus.api.html">bus.api</a></li>
            
                <li><a href="../modules/bus.api.Type.html">bus.api.Type</a></li>
            
                <li><a href="../modules/bus.api.Value.html">bus.api.Value</a></li>
            
                <li><a href="../modules/bus.network.html">bus.network</a></li>
            
                <li><a href="../modules/bus.network.packets.html">bus.network.packets</a></li>
            
                <li><a href="../modules/bus.security.html">bus.security</a></li>
            
                <li><a href="../modules/bus.transport.html">bus.transport</a></li>
            
                <li><a href="../modules/bus.util.html">bus.util</a></li>
            
                <li><a href="../modules/client.html">client</a></li>
            
                <li><a href="../modules/common.html">common</a></li>
            
                <li><a href="../modules/metrics.html">metrics</a></li>
            
                <li><a href="../modules/metrics.statistics.html">metrics.statistics</a></li>
            
                <li><a href="../modules/metrics.types.html">metrics.types</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: app/js/bus/security/pdp.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
ozpIwc = ozpIwc || {};

ozpIwc.policyAuth = ozpIwc.policyAuth || {};

/**
 * System entity that evaluates applicable policy and renders an authorization decision.
 * @class PDP
 * @namespace ozpIwc.policyAuth
 *
 * @param {Object} config
 * @param {ozpIwc.policyAuth.PRP} config.prp Policy Repository Point for the PDP to gather policies from.
 * @param {ozpIwc.policyAuth.PIP} config.pip Policy Information Point for the PDP to gather attributes from.
 * @constructor
 */
ozpIwc.policyAuth.PDP = function(config){
    config=config || {};

    /**
     * Policy Repository Point
     * @property prp
     * @type {ozpIwc.policyAuth.PRP}
     * @default new ozpIwc.policyAuth.PRP()
     */
    this.prp = config.prp ||  new ozpIwc.policyAuth.PRP();


    /**
     * Policy Information Point
     * @property pip
     * @type {ozpIwc.policyAuth.PIP}
     * @default new ozpIwc.policyAuth.PIP()
     */
    this.pip = config.pip || new ozpIwc.policyAuth.PIP();

    this.policySets = config.policySets ||
    {
        &#x27;connectSet&#x27;: [&quot;policy://ozpIwc/connect&quot;],
        &#x27;apiSet&#x27;: [&quot;policy://policy/apiNode&quot;],
        &#x27;readSet&#x27;: [&quot;policy://policy/read&quot;],
        &#x27;receiveAsSet&#x27;: [&quot;policy://policy/receiveAs&quot;],
        &#x27;sendAsSet&#x27;: [&quot;policy://policy/sendAs&quot;]
    };
};


/**
 * @method isPermitted(request)
 * @param {Object | String} [request.subject]       The subject attributes or id performing the action.
 * @param {Object | String} [request.resource]      The resource attributes or id that is being acted upon.
 * @param {Object | String} [request.action]        The action attributes.  A string should be interpreted as the
 *                                                  value of the “action-id” attribute.
 * @param {Array&lt;String&gt;} [request.policies]        A list of URIs applicable to this decision.
 * @param {String} [request. combiningAlgorithm]    Only supports “deny-overrides”
 * @param {Object} [contextHolder]                  An object that holds &#x27;securityAttribute&#x27; attributes to populate the
 *                                                  PIP cache with for request/policy use.
 * @returns {ozpIwc.AsyncAction} will resolve with &#x27;success&#x27; if the policy gives a &quot;Permit&quot;.
 *                                    rejects else wise. the async success will receive:
 * &#x60;&#x60;&#x60;{
 *      &#x27;result&#x27;: &lt;String&gt;,
 *      &#x27;request&#x27;: &lt;Object&gt; // a copy of the request passed in,
 *      &#x27;formattedRequest&#x27;: &lt;Object&gt; // a copy of the formatted request (for PDP user caching)
 *    }&#x60;&#x60;&#x60;
 */
ozpIwc.policyAuth.PDP.prototype.isPermitted = function(request){
    var asyncAction = new ozpIwc.AsyncAction();

    var self = this;
    //If there is no request information, its a trivial &quot;Permit&quot;
    if(!request){
        return asyncAction.resolve(&#x27;success&#x27;,{
                &#x27;result&#x27;:&quot;Permit&quot;
            });
    }


    var onError = function(err){
        asyncAction.resolve(&#x27;failure&#x27;,err);
    };
    //Format the request
    this.formatRequest(request)
        .success(function(formattedRequest){

            // Get the policies from the PRP
            self.prp.getPolicies(formattedRequest.policies)
                .success(function(policies){

                    var result = ozpIwc.policyAuth.PolicyCombining[formattedRequest.combiningAlgorithm](policies,formattedRequest.category);
                    var response = {
                        &#x27;result&#x27;:result,
                        &#x27;request&#x27;: request,
                        &#x27;formattedRequest&#x27;: formattedRequest
                    };
                    if(result === &quot;Permit&quot;){
                       asyncAction.resolve(&#x27;success&#x27;,response);
                    } else {
                        onError(response);
                    }
                }).failure(onError);
        }).failure(onError);
    return asyncAction;
};


ozpIwc.policyAuth.PDP.prototype.formatAttributes = function(attributes,pip){
    attributes = Array.isArray(attributes) ? attributes : [attributes];
    var asyncAction = new ozpIwc.AsyncAction();
    pip = pip || this.pip;
    var asyncs = [];
    for(var i in attributes){
        asyncs.push(this.formatAttribute(attributes[i],pip));
    }
    ozpIwc.AsyncAction.all(asyncs).success(function(attrs){
        var retObj = {};
        for(var i in attrs){
            if(Object.keys(attrs[i]).length &gt; 0) {
                for (var j in attrs[i]) {
                    retObj[j] = attrs[i][j];
                }
            }
        }
        asyncAction.resolve(&quot;success&quot;,retObj);
    });
    return asyncAction;
};




    /**
 * Takes a URN, array of urns, object, array of objects, or array of any combination and fetches/formats to the
 * necessary structure to be used by a request of policy&#x27;s category object.
 *
 * @method formatAttribute
 * @param {String|Object|Array&lt;String|Object&gt;}attribute The attribute to format
 * @param {ozpIwc.policyAuth.PIP} [pip] Policy information point, uses ozpIwc.authorization.pip by default.
 * @returns {ozpIwc.AsyncAction} returns an async action that will resolve with an object of the formatted attributes.
 *                               each attribute is ID indexed in the object, such that the formatting of id
 *                               &#x60;ozp:iwc:node&#x60; which has attributes &#x60;a&#x60; and &#x60;b&#x60;would resolve as follows:
 *                  &#x60;&#x60;&#x60;
 *                  {
 *                      &#x27;ozp:iwc:node&#x27;: {
 *                          &#x27;attributeValues&#x27;: [&#x27;a&#x27;,&#x27;b&#x27;]
 *                       }
 *                  }
 *                  &#x60;&#x60;&#x60;
 *
 */
ozpIwc.policyAuth.PDP.prototype.formatAttribute = function(attribute,pip){
    var asyncAction = new ozpIwc.AsyncAction();
    pip = pip || this.pip;
    if(!attribute){
        return asyncAction.resolve(&#x27;success&#x27;);
    }


    if(!attribute){
        //do nothing and return an empty object.
        asyncAction.resolve(&#x27;success&#x27;, {});

    }else if(typeof attribute === &quot;string&quot;) {
        // If its a string, use it as a key and fetch its attrs from PIP
        pip.getAttributes(attribute)
            .success(function(attr){
                //TODO check if is an array or string (APPLY RECURSION!)
                asyncAction.resolve(&quot;success&quot;,attr);
            });

    } else if(Array.isArray(attribute)){
        // If its an array, its multiple actions. Wrap as needed
        return this.formatAttributes(attribute,pip);

    } else if(typeof attribute === &quot;object&quot;){
        // If its an object, make sure each key&#x27;s value is an array.
        var keys = Object.keys(attribute);
        for (var i in keys) {
            var tmp = attribute[keys[i]];
            if ([&#x27;string&#x27;, &#x27;number&#x27;, &#x27;boolean&#x27;].indexOf(typeof attribute[keys[i]]) &gt;= 0) {
                attribute[keys[i]] =  [tmp];
            }
            attribute[keys[i]] = attribute[keys[i]] || [];
        }
        asyncAction.resolve(&quot;success&quot;,attribute);
    }
    return asyncAction;
};



/**
 * Formats an action to be used by a request or policy. Actions are not gathered from the Policy Information Point.
 * Rather they are string values explaining the operation to be permitted. To comply with XACML, these strings are
 * wrapped in objects for easier comparison
 *
 * @method formatAction
 * @param {String|Object|Array&lt;String|Object&gt;} action
 * @returns {Object} An object of formatted actions indexed by the ozp action id &#x60;ozp:action:id&#x60;.
 *                   An example output for actions [&#x27;read&#x27;,&#x27;write&#x27;] is as follows:
 *      &#x60;&#x60;&#x60;
 *      {
 *          &#x27;ozp:iwc:action&#x27;: {
 *              &#x27;attributeValue&#x27;: [&#x27;read&#x27;, &#x27;write&#x27;]
 *          }
 *      }
 *      &#x60;&#x60;&#x60;
 *
 */
ozpIwc.policyAuth.PDP.prototype.formatAction = function(action){

    var formatted =  [];

    var objectHandler = function(object,formatted){
        var values;
        // We only care about attributeValues
        if(object[&#x27;ozp:iwc:action&#x27;]){
            values = object[&#x27;ozp:iwc:action&#x27;];
        }
        if(Array.isArray(values)) {
                return arrayHandler(values,formatted);
        } else if([&#x27;string&#x27;, &#x27;number&#x27;, &#x27;boolean&#x27;].indexOf(typeof values) &gt;= 0){
            if(formatted.indexOf(values) &lt; 0){
                formatted.push(values);
            }
        }
    };
    var arrayHandler = function(array,formatted){
        for(var i in array){
            if(typeof array[i] === &#x27;string&#x27;) {
                if (formatted.indexOf(array[i]) &lt; 0) {
                    formatted.push(array[i]);
                }
            } else if(Array.isArray(array[i])){
                arrayHandler(array[i],formatted);
            } else if(typeof array[i] === &#x27;object&#x27;) {
                objectHandler(array[i],formatted);
            }
        }
    };

    if(!action){
        //do nothing and return an empty array
    }else if(typeof action === &quot;string&quot;){
        // If its a string, its a single action.
        formatted.push(action);
    } else if(Array.isArray(action)){
        arrayHandler(action,formatted);
    } else if(typeof action === &#x27;object&#x27;){
        objectHandler(action,formatted);
    }

    return {&#x27;ozp:iwc:action&#x27;: formatted};
};

/**
 * Takes a request object and applies any context needed from the PIP.
 *
 * @method formatRequest
 * @param {Object}          request
 * @param {String|Array&lt;String&gt;|Object}    request.subject URN(s) of attribute to gather, or formatted subject object
 * @param {String|Array&lt;String&gt;Object}     request.resource URN(s) of attribute to gather, or formatted resource object
 * @param {String|Array&lt;String&gt;Object}     request.action URN(s) of attribute to gather, or formatted action object
 * @param {String}                         request.combiningAlgorithm URN of combining algorithm
 * @param {Array&lt;String|ozpIwc.policyAuth.Policy&gt;}   request.policies either a URN or a formatted policy
 * @param {ozpIwc.policyAuth.PIP} [pip] custom policy information point for attribute gathering.
 * @returns {ozpIwc.AsyncAction}  will resolve when all attribute formatting completes.
 *                    The resolution will pass a formatted
 *                      structured as so:
 *                    &#x60;&#x60;&#x60;{
 *                      &#x27;category&#x27;:{
 *                          &quot;urn:oasis:names:tc:xacml:1.0:subject-category:access-subject&quot;: {
 *                              &lt;AttributeId&gt;: {
 *                                  &quot;attributeValues&quot;: Array&lt;Primitive&gt;
 *                              }
 *                          },
 *                          &quot;urn:oasis:names:tc:xacml:3.0:attribute-category:resource&quot;: {
 *                              &lt;AttributeId&gt;: {
 *                                  &quot;attributeValues&quot;: Array&lt;Primitive&gt;
 *                              }
 *                          },
 *                          &quot;urn:oasis:names:tc:xacml:3.0:attribute-category:action&quot;: {
 *                              &quot;ozp:iwc:action&quot;: {
 *                                  &quot;attributeValues&quot;: Array&lt;String&gt;
 *                              }
 *                          }
 *                       },
 *                      &#x27;combiningAlgorithm&#x27;: request.combiningAlgorithm,
 *                      &#x27;policies&#x27;: request.policies
 *                     }&#x60;&#x60;&#x60;
 */
ozpIwc.policyAuth.PDP.prototype.formatRequest = function(request,pip){
    var asyncAction = new ozpIwc.AsyncAction();
    pip = pip || this.pip;
    request = request || {};
    request.subject = request.subject || {};
    request.resource = request.resource || {};
    request.action = request.action || {};
    request.combiningAlgorithm = request.combiningAlgorithm || this.defaultCombiningAlgorithm;
    var asyncs = [];

    var subjectAsync = this.formatAttribute(request.subject,pip);
    var resourceAsync = this.formatAttribute(request.resource,pip);
    var actions = this.formatAction(request.action);

    asyncs.push(subjectAsync,resourceAsync,actions);

    ozpIwc.AsyncAction.all(asyncs)
        .success(function(gatheredAttributes){
            var sub = gatheredAttributes[0];
            var res = gatheredAttributes[1];
            var act = gatheredAttributes[2];
            asyncAction.resolve(&#x27;success&#x27;,{
                &#x27;category&#x27;:{
                    &quot;subject&quot;: sub,
                    &quot;resource&quot;: res,
                    &quot;action&quot;: act
                },
                &#x27;combiningAlgorithm&#x27;: request.combiningAlgorithm,
                &#x27;policies&#x27;: request.policies
            });
        }).failure(function(err){
            asyncAction.resolve(&#x27;failure&#x27;,err);
        });
    return asyncAction;
};

/**
 * The URN of the default combining algorithm to use when basing a decision on multiple policies.
 * @property defaultCombiningAlgorithm
 * @type {String}
 * @default &quot;urn:oasis:names:tc:xacml:3.0:policy-combining-algorithm:deny-overrides&quot;
 */
ozpIwc.policyAuth.PDP.prototype.defaultCombiningAlgorithm = &quot;deny-overrides&quot;;

/**
 * Formats a category object. If needed the attribute data is gathered from the PIP.
 *
 * @method formatCategory
 * @param {String|Array&lt;String&gt;|Object} category the category (subject,resource,action) to format
 * @param {String} categoryId the category name used to map to its corresponding attributeId (see PDP.mappedID)
 * @param {ozpIwc.policyAuth.PIP} [pip] custom policy information point for attribute gathering.
 * @returns {ozpIwc.AsyncAction}  will resolve with a category object formatted as so:
 *      &#x60;&#x60;&#x60;
 *      {
 *          &lt;AttributeId&gt;: {
 *              &#x27;attributeValue&#x27;: {Array&lt;Primative&gt;}
 *          }
 *      }
 *      &#x60;&#x60;&#x60;
 *
 */
ozpIwc.policyAuth.PDP.prototype.formatCategory = function(category,pip){
    var asyncAction = new ozpIwc.AsyncAction();
    if(!category){
        return asyncAction.resolve(&#x27;success&#x27;);
    }

    pip = pip || this.pip;

    this.formatAttribute(category,pip)
        .success(function(attributes){
            for(var i in attributes[&#x27;ozp:iwc:permissions&#x27;]){
                attributes[i] = attributes[&#x27;ozp:iwc:permissions&#x27;][i];
            }
            delete attributes[&#x27;ozp:iwc:permissions&#x27;];
            asyncAction.resolve(&#x27;success&#x27;,attributes);
        }).failure(function(err){
            asyncAction.resolve(&#x27;failure&#x27;,err);
        });
    return asyncAction;
};

/**
 *
 * Category context handling for policy objects.
 * Takes object key-indexed categories for a policy
 * and returns an object key-indexed listing of formatted. Each category is keyed by its XACML URN. currently only
 * subject,resource, and action categories are supported.
 *
 * @method formatCategories
 * @param {Object} categoryObj An object of categories to format.
 * @param {Object|String|Array&lt;String|Object&gt;}[categoryObj[&lt;categoryId&gt;]] A category to format
 * @param {ozpIwc.policyAuth.PIP} [pip] custom policy information point for attribute gathering.
 * @returns {ozpIwc.AsyncAction} will resolve an object of categories be structured as so:
 * &#x60;&#x60;&#x60;
 * {
 *   &#x27;&lt;categoryId&gt;&#x27; : {
 *      &lt;AttributeId&gt;:{
 *          &#x27;attributeValue&#x27; : Array&lt;Primitive&gt;
 *      },
 *      &lt;AttributeId&gt;:{
 *          &#x27;attributeValue&#x27; : Array&lt;Primitive&gt;
 *      }
 *   },
 *   &#x27;&lt;categoryId&gt;&#x27;: {...},
 *   ...
 * }
 * &#x60;&#x60;&#x60;
 */
ozpIwc.policyAuth.PDP.prototype.formatCategories = function(categoryObj,pip){
    var asyncAction = new ozpIwc.AsyncAction();
    pip = pip || this.pip;
    var categoryAsyncs = [];
    var categoryIndexing = {};
    for(var i in categoryObj){
        categoryAsyncs.push(this.formatCategory(categoryObj[i],pip));
        categoryIndexing[i] = categoryAsyncs.length - 1;
    }
    ozpIwc.AsyncAction.all(categoryAsyncs)
        .success(function(categories){
            var map = {};
            var keys = Object.keys(categoryIndexing);
            for(var i in keys){
                map[keys[i]] = categories[categoryIndexing[keys[i]]] || {};
            }
            asyncAction.resolve(&#x27;success&#x27;,map);
        }).failure(function(err){
            asyncAction.resolve(&#x27;failure&#x27;,err);
        });
    return asyncAction;
};

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
