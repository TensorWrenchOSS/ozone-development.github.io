var ozpIwc=ozpIwc||{};ozpIwc.util=ozpIwc.util||{},ozpIwc.util.generateId=function(){return Math.floor(4294967295*Math.random()).toString(16)},ozpIwc.util.now=function(){return(new Date).getTime()},ozpIwc.util.extend=function(a,b){return b.prototype=Object.create(a.prototype),b.prototype.constructor=b,b};var ozpIwc=ozpIwc||{};ozpIwc.metricsStats=ozpIwc.metricsStats||{},ozpIwc.metricsStats.DEFAULT_POOL_SIZE=1028,ozpIwc.metricsStats.Sample=function(){this.clear()},ozpIwc.metricsStats.Sample.prototype.update=function(a){this.values.push(a)},ozpIwc.metricsStats.Sample.prototype.clear=function(){this.values=[],this.count=0},ozpIwc.metricsStats.Sample.prototype.size=function(){return this.values.length},ozpIwc.metricsStats.Sample.prototype.getValues=function(){return this.values},ozpIwc.metricsStats.UniformSample=ozpIwc.util.extend(ozpIwc.metricsStats.Sample,function(a){ozpIwc.metricsStats.Sample.apply(this),this.limit=a||ozpIwc.metricsStats.DEFAULT_POOL_SIZE}),ozpIwc.metricsStats.UniformSample.prototype.update=function(a){if(this.count++,this.size()<this.limit)this.values.push(a);else{var b=parseInt(Math.random()*this.count);b<this.limit&&(this.values[b]=a)}};var ozpIwc=ozpIwc||{};ozpIwc.metricsStats=ozpIwc.metricsStats||{},ozpIwc.metricsStats.BinaryHeap=function(a){this.content=[],this.scoreFunction=a},ozpIwc.metricsStats.BinaryHeap.prototype={clone:function(){var a=new ozpIwc.metricsStats.BinaryHeap(this.scoreFunction);return a.content=JSON.parse(JSON.stringify(this.content)),a},push:function(a){this.content.push(a),this.bubbleUp(this.content.length-1)},peek:function(){return this.content[0]},pop:function(){var a=this.content[0],b=this.content.pop();return this.content.length>0&&(this.content[0]=b,this.sinkDown(0)),a},remove:function(a){for(var b=this.content.length,c=0;b>c;c++)if(this.content[c]==a){var d=this.content.pop();return c!=b-1&&(this.content[c]=d,this.scoreFunction(d)<this.scoreFunction(a)?this.bubbleUp(c):this.sinkDown(c)),!0}throw new Error("Node not found.")},size:function(){return this.content.length},bubbleUp:function(a){for(var b=this.content[a];a>0;){var c=Math.floor((a+1)/2)-1,d=this.content[c];if(!(this.scoreFunction(b)<this.scoreFunction(d)))break;this.content[c]=b,this.content[a]=d,a=c}},sinkDown:function(a){for(var b=this.content.length,c=this.content[a],d=this.scoreFunction(c);;){var e=2*(a+1),f=e-1,g=null;if(b>f){var h=this.content[f],i=this.scoreFunction(h);d>i&&(g=f)}if(b>e){var j=this.content[e],k=this.scoreFunction(j);(null==g?d:i)>k&&(g=e)}if(null==g)break;this.content[a]=this.content[g],this.content[g]=c,a=g}}};var ozpIwc=ozpIwc||{};ozpIwc.metricsStats=ozpIwc.metricsStats||{},ozpIwc.metricsStats.DEFAULT_RESCALE_THRESHOLD=36e5,ozpIwc.metricsStats.DEFAULT_DECAY_ALPHA=.015,ozpIwc.metricsStats.ExponentiallyDecayingSample=ozpIwc.util.extend(ozpIwc.metricsStats.Sample,function(a,b){ozpIwc.metricsStats.Sample.apply(this),this.limit=a||ozpIwc.metricsStats.DEFAULT_POOL_SIZE,this.alpha=b||ozpIwc.metricsStats.DEFAULT_DECAY_ALPHA,this.rescaleThreshold=ozpIwc.metricsStats.DEFAULT_RESCALE_THRESHOLD}),ozpIwc.metricsStats.ExponentiallyDecayingSample.prototype.getValues=function(){for(var a,b=[],c=this.values.clone();a=c.pop();)b.push(a.val);return b},ozpIwc.metricsStats.ExponentiallyDecayingSample.prototype.size=function(){return this.values.size()},ozpIwc.metricsStats.ExponentiallyDecayingSample.prototype.newHeap=function(){return new ozpIwc.metricsStats.BinaryHeap(function(a){return a.priority})},ozpIwc.metricsStats.ExponentiallyDecayingSample.prototype.now=function(){return ozpIwc.util.now()},ozpIwc.metricsStats.ExponentiallyDecayingSample.prototype.tick=function(){return this.now()/1e3},ozpIwc.metricsStats.ExponentiallyDecayingSample.prototype.clear=function(){this.values=this.newHeap(),this.count=0,this.startTime=this.tick(),this.nextScaleTime=this.now()+this.rescaleThreshold},ozpIwc.metricsStats.ExponentiallyDecayingSample.prototype.update=function(a,b){void 0==b?b=this.tick():b/=1e3;var c=this.weight(b-this.startTime)/Math.random(),d={val:a,priority:c};if(this.count<this.limit)this.count+=1,this.values.push(d);else{var e=this.values.peek();e.priority<c&&(this.values.push(d),this.values.pop())}this.now()>this.nextScaleTime&&this.rescale()},ozpIwc.metricsStats.ExponentiallyDecayingSample.prototype.weight=function(a){return Math.exp(this.alpha*a)},ozpIwc.metricsStats.ExponentiallyDecayingSample.prototype.rescale=function(){this.nextScaleTime=this.now()+this.rescaleThreshold;var a=this.values.content,b=[],c=this.startTime;this.startTime=this.tick();for(var d=0;d<a.length;d++)b.push({val:a[d].val,priority:a[d].priority*Math.exp(-this.alpha*(this.startTime-c))});this.values.content=b};var ozpIwc=ozpIwc||{};ozpIwc.metricsStats=ozpIwc.metricsStats||{},ozpIwc.metricsStats.M1_ALPHA=1-Math.exp(-5/60),ozpIwc.metricsStats.M5_ALPHA=1-Math.exp(-5/60/5),ozpIwc.metricsStats.M15_ALPHA=1-Math.exp(-5/60/15),ozpIwc.metricsStats.ExponentiallyWeightedMovingAverage=function(a,b){this.alpha=a,this.interval=b||5e3,this.currentRate=null,this.uncounted=0,this.lastTick=ozpIwc.util.now()},ozpIwc.metricsStats.ExponentiallyWeightedMovingAverage.prototype.update=function(a){this.uncounted+=a||1,this.tick()},ozpIwc.metricsStats.ExponentiallyWeightedMovingAverage.prototype.tick=function(){var a=ozpIwc.util.now(),b=a-this.lastTick;if(b>this.interval){this.lastTick=a-b%this.interval;for(var c=Math.floor(b/this.interval),d=0;c>d;++d){var e=this.uncounted/this.interval;this.uncounted=0,null!==this.currentRate?this.currentRate+=this.alpha*(e-this.currentRate):this.currentRate=e}}},ozpIwc.metricsStats.ExponentiallyWeightedMovingAverage.prototype.rate=function(){return 1e3*this.currentRate};var ozpIwc=ozpIwc||{},ozpIwc=ozpIwc||{};ozpIwc.metricTypes=ozpIwc.metricTypes||{},ozpIwc.metricTypes.BaseMetric=function(){this.value=0},ozpIwc.metricTypes.BaseMetric.prototype.get=function(){return this.value},ozpIwc.metricTypes.BaseMetric.prototype.unit=function(a){return a?(this.unit=a,this):this.unit},ozpIwc.MetricsRegistry=function(){this.metrics={}},ozpIwc.MetricsRegistry.prototype.findOrCreateMetric=function(a,b){var c=this.metrics[a]=this.metrics[a]||new b;return c instanceof b?c:null},ozpIwc.MetricsRegistry.prototype.makeName=function(a){return Array.prototype.slice.call(a).join(".")},ozpIwc.MetricsRegistry.prototype.counter=function(){return this.findOrCreateMetric(this.makeName(arguments),ozpIwc.metricTypes.Counter)},ozpIwc.MetricsRegistry.prototype.meter=function(){return this.findOrCreateMetric(this.makeName(arguments),ozpIwc.metricTypes.Meter)},ozpIwc.MetricsRegistry.prototype.gauge=function(){return this.findOrCreateMetric(this.makeName(arguments),ozpIwc.metricTypes.Gauge)},ozpIwc.MetricsRegistry.prototype.histogram=function(){return this.findOrCreateMetric(this.makeName(arguments),ozpIwc.metricTypes.Histogram)},ozpIwc.MetricsRegistry.prototype.timer=function(){return this.findOrCreateMetric(this.makeName(arguments),ozpIwc.metricTypes.Timer)},ozpIwc.MetricsRegistry.prototype.register=function(a,b){return this.metrics[this.makeName(a)]=b,b},ozpIwc.MetricsRegistry.prototype.toJson=function(){var a={};for(var b in this.metrics){for(var c=b.split("."),d=a;c.length>1;){var e=c.shift();d=d[e]=d[e]||{}}d[c[0]]=this.metrics[b].get()}return a},ozpIwc.metrics=new ozpIwc.MetricsRegistry,ozpIwc.metricTypes.Counter=ozpIwc.util.extend(ozpIwc.metricTypes.BaseMetric,function(){ozpIwc.metricTypes.BaseMetric.apply(this,arguments),this.value=0}),ozpIwc.metricTypes.Counter.prototype.inc=function(a){return this.value+=a?a:1},ozpIwc.metricTypes.Counter.prototype.dec=function(a){return this.value-=a?a:1},ozpIwc.metricTypes.Gauge=function(a){this.callback=a},ozpIwc.metricTypes.Gauge.prototype.set=function(a){return callback=a,this},ozpIwc.metricTypes.Gauge.prototype.get=function(){return callback()},ozpIwc.metricTypes.Histogram=ozpIwc.util.extend(ozpIwc.metricTypes.BaseMetric,function(){ozpIwc.metricTypes.BaseMetric.apply(this,arguments),this.sample=new ozpIwc.metricsStats.ExponentiallyDecayingSample,this.clear()}),ozpIwc.metricTypes.Histogram.prototype.clear=function(){this.sample.clear(),this.min=this.max=null,this.varianceMean=0,this.varianceM2=0,this.sum=0,this.count=0},ozpIwc.metricTypes.Histogram.prototype.mark=function(a,b){b=b||ozpIwc.util.now(),this.sample.update(a,b),this.max=null===this.max?a:Math.max(this.max,a),this.min=null===this.min?a:Math.min(this.min,a),this.sum+=a,this.count++;var c=a-this.varianceMean;return this.varianceMean+=c/this.count,this.varianceM2+=c*(a-this.varianceMean),this.count},ozpIwc.metricTypes.Histogram.prototype.get=function(){var a=this.sample.getValues().map(function(a){return parseFloat(a)}).sort(function(a,b){return a-b}),b=function(b){var c=b*a.length;if(c>=a.length)return a[a.length-1];c=Math.max(0,c),c=Math.min(c,a.length+1);var d=a[Math.floor(c)-1],e=a[Math.floor(c)];return d+(c-Math.floor(c))*(e-d)};return{percentile_10:b(.1),percentile_25:b(.25),median:b(.5),percentile_75:b(.75),percentile_90:b(.9),percentile_95:b(.95),percentile_99:b(.99),percentile_999:b(.999),variance:this.count<1?null:this.varianceM2/(this.count-1),mean:0===this.count?null:this.varianceMean,stdDev:this.count<1?null:Math.sqrt(this.varianceM2/(this.count-1)),count:this.count,sum:this.sum,max:this.max,min:this.min}},ozpIwc.metricTypes.Meter=ozpIwc.util.extend(ozpIwc.metricTypes.BaseMetric,function(){ozpIwc.metricTypes.BaseMetric.apply(this,arguments),this.m1Rate=new ozpIwc.metricsStats.ExponentiallyWeightedMovingAverage(ozpIwc.metricsStats.M1_ALPHA),this.m5Rate=new ozpIwc.metricsStats.ExponentiallyWeightedMovingAverage(ozpIwc.metricsStats.M5_ALPHA),this.m15Rate=new ozpIwc.metricsStats.ExponentiallyWeightedMovingAverage(ozpIwc.metricsStats.M15_ALPHA),this.startTime=ozpIwc.util.now(),this.value=0}),ozpIwc.metricTypes.Meter.prototype.mark=function(a){return a=a||1,this.value+=a,this.m1Rate.update(a),this.m5Rate.update(a),this.m15Rate.update(a),this.value},ozpIwc.metricTypes.Meter.prototype.get=function(){return{rate_1m:this.m1Rate.rate(),rate_5m:this.m5Rate.rate(),rate_15m:this.m15Rate.rate(),rate_mean:this.value/(ozpIwc.util.now()-this.startTime)*1e3,count:this.value}},ozpIwc.metricTypes.Meter.prototype.tick=function(){this.m1Rate.tick(),this.m5Rate.tick(),this.m15Rate.tick()},ozpIwc.metricTypes.Timer=ozpIwc.util.extend(ozpIwc.metricTypes.BaseMetric,function(){ozpIwc.metricTypes.BaseMetric.apply(this,arguments),this.meter=new ozpIwc.metricTypes.Meter,this.histogram=new ozpIwc.metricTypes.Histogram}),ozpIwc.metricTypes.Timer.prototype.mark=function(a,b){this.meter.mark(),this.histogram.mark(a,b)},ozpIwc.metricTypes.Timer.prototype.start=function(){var a=this,b=ozpIwc.util.now();return function(){var c=ozpIwc.util.now();a.mark(c-b,c)}},ozpIwc.metricTypes.Timer.prototype.time=function(a){var b=ozpIwc.util.now();try{a()}finally{var c=ozpIwc.util.now();this.mark(c-b,c)}},ozpIwc.metricTypes.Timer.prototype.get=function(){var a=this.histogram.get(),b=this.meter.get();for(var c in b)a[c]=b[c];return a};